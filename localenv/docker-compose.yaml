# contains services shared by localenv and apitest environments

version: "3.8"
services:

  graph-node:
    image: graphprotocol/graph-node:v0.35.1
    platform: linux/amd64
    ports:
      - '8000:8000'
      - '8001:8001'
      - '8020:8020'
      - '8030:8030'
      - '8040:8040'
    networks:
      - octant
    depends_on:
      - ipfs
      - graph-postgres
    environment:
      NETWORK_NAME: localhost
      RPC_PROVIDER: http://anvil:8545
      postgres_host: graph-postgres
      postgres_user: graph-node
      postgres_pass: let-me-in
      postgres_db: graph-node
      ipfs: 'ipfs:5001'
      ethereum: localhost:http://anvil:8545
      GRAPH_LOG: debug
      ETHEREUM_REORG_THRESHOLD: 0

  ipfs:
    image: ipfs/kubo:v0.27.0
    ports:
      - '5001:5001'
    networks:
      - octant

  graph-postgres:
    image: postgres
    ports:
      - '5433:5432'
    networks:
      - octant
    command:
      [
        "postgres",
        "-cshared_preload_libraries=pg_stat_statements"
      ]
    environment:
      POSTGRES_USER: graph-node
      POSTGRES_PASSWORD: let-me-in
      POSTGRES_DB: graph-node
      POSTGRES_INITDB_ARGS: '--encoding=UTF-8 --lc-collate=C --lc-ctype=C'

  multideployer:
    image: octant/multideployer:latest
    networks:
      - octant
    depends_on:
      - anvil
      - graph-node
    ports:
      - '8022:8022'
    environment:
      RPC_URL: http://anvil:8545
      NETWORK: localhost
      SKIP_LOCAL_SUBGRAPH_UPDATE: true
      EPOCH_DURATION: 600

      PROPOSALS_CID: QmXq3Eaz5xQF51J7mWzxDmfrVjDuGdhnirthttJ9Q2WTF8
      PROPOSALS_ADDRESSES: 0x0B924785D2bBBc8834cbd5Fc63D10543ff799D4D,0xEd88424737639e3c891F3f2357E82f33676d98C1,0x54A80e0417008dB88036F4Fb2C4646264717f7a6,0x1e3e113d1ec2A020316320c812422997a798B5D2,0xfda84EAda14805beBD3583BbA087769af91BbCfc,0x12fD44062F9EdeC06ef1F58248eF8fcF093ac74c,0x8eF2d19248A341B46e8071b4C2F0295c41964CC0,0x1D7be81B8508728b30522FE1a1a8EeecF71c347e,0xB2Ebc9b3a788aFB1E942eD65B59E9E49A1eE500D,0xd9b0052F02ab9f3f8aC7715Ab60F7812241CB8E6,0xE74bbe83747ad12F24ecc5E9e4fAF7CFd7D487A2,0x2f1580Efbf5A2CF694db389765e8EA863bD5c4d0,0xa247539785eAD7040D0e070A2F24A320B193AdFE,0x763024B971cAbdafA229a99E9736169d6D85e010,0xB4c37667b66788504E678aFb1fd234f24BC0360A,0x472F64877Ee59E57b92e0c09569feA6c32307D76,0xca85460d23Bfb2e0079bAb5AAC84921D9D0762a4,0x085A35D9F98AaADa57fa6933de65Cf7248b9C9aE,0xd4165c58B83CFDbfd8Dcf8b34F22340F5Cd105E9,0x5BF65EE6f1639E7A1C146D6A638c52fF0567873f,0xFd1e1CBca077AE058008943C558146D474086852,0xA50064D462e17f7091eE62BaebeB18BFEBE21507,0xaDb8e7F41FD0C9FdbE49C31c6b7Ff00Ca3F0E92E,0x22C7A94d44AEafAC088454749d3F02A5C239A716,0xF346AD74368171E743ee4226DA0E20F4350c839C,0xc3aC33B56E2641fD4eD25aF24F0FC268c881dc25,0x17c57bD297175e5711Ee3Daf045252B588f3162F,0x77DCB767ae72d6aff6B8C20c2a76C6f66A5Cb46c,0xe09Dce2c070A7271569A67F27e8eA35c00B2BbfA,0x6CB4420A424581Df2154799c21D4e9A2d1D55826

      IPFS_URL: http://ipfs:5001
      SUBGRAPH_ADMIN_URL: http://graph-node:8020
      SUBGRAPH_QUERY_URL: http://graph-node:8000

networks:
  octant:
